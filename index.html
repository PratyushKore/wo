<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Workout Tracker</title>

<style>
:root{color-scheme:dark}
body{
  margin:0;
  background:#0b0f14;
  color:#e7eef8;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
}
.app{max-width:1100px;margin:auto;padding:1rem}
h1{margin:0 0 .75rem}
.controls{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:1rem}
button{
  background:#121c28;
  color:#e7eef8;
  border:1px solid #233244;
  border-radius:8px;
  padding:.45rem .75rem;
  cursor:pointer;
}
button:hover{border-color:#63b3ff}
.week{
  border:1px solid #233244;
  border-radius:12px;
  margin-bottom:1rem;
  background:#0f1620;
}
summary{
  padding:.75rem 1rem;
  cursor:pointer;
  font-weight:600;
}
.week-body{padding:.75rem 1rem 1rem}
.row{
  display:grid;
  grid-template-columns:1fr repeat(7,1.4rem);
  gap:.4rem;
  align-items:center;
  margin:.25rem 0;
}
.row small{opacity:.65}
input[type=checkbox]{
  width:1.1rem;
  height:1.1rem;
  accent-color:#63b3ff;
}
.footer{
  display:flex;
  justify-content:space-between;
  gap:1rem;
  flex-wrap:wrap;
}
.status{opacity:.7;font-size:.85rem}
</style>
</head>

<body>
<div class="app">
<h1>Workout Tracker</h1>

<div class="controls">
  <button onclick="copySave()">Copy save text</button>
  <button onclick="downloadSave()">Save to file</button>
  <button onclick="pasteImport()">Paste import</button>
  <input type="file" onchange="importFile(this)">
</div>

<div id="weeks"></div>

<div class="footer">
  <button onclick="addWeek()">➕ Add Week (copy Week 16)</button>
  <div class="status" id="status">Ready</div>
</div>
</div>

<script>
/* =========================
   GITHUB CONFIG (EDIT)
   ========================= */
const GITHUB_OWNER  = "PratyushKore";
const GITHUB_REPO   = "wo";
const GITHUB_BRANCH = "main";
const SAVEFILE_PATH = "savefile.txt";
const GITHUB_TOKEN  = "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";

/* =========================
   FULL WORKOUT DATA
   ========================= */
const WEEKS = [
[
"5 minute stretch/warm-up","Workout:",
"4 x 15 pushups","4 x 20 situps","3 x 3 pullups",
"5 minute walk","1 minute jog","5 minute walk","1 minute jog",
"3-5 minute walk","2 minute stretch"
],
[
"5 minute stretch/warm-up","Workout:",
"5 x 20 pushups","5 x 20 situps","3 x 3 pullups",
"5 minute walk","3 minute jog","5 minute walk","3 minute jog",
"3-5 minute walk","2 minute stretch"
],
[
"5 minute stretch/warm-up","Workout:",
"5 x 25 pushups","5 x 25 situps","3 x 4 pullups",
"4 minute walk","5 minute jog","4 minute walk","5 minute jog",
"3-5 minute walk","2 minute stretch"
],
[
"5 minute stretch/warm-up","Workout:",
"5 x 25 pushups","5 x 25 situps","3 x 4 pullups",
"4 minute walk","5 minute jog","4 minute walk","5 minute jog",
"3-5 minute walk","2 minute stretch"
],
[
"5 minute stretch/warm-up","Workout:",
"6 x 25 pushups","6 x 25 situps","2 x 8 pullups",
"4 minute walk","6 minute jog","4 minute walk","6 minute jog",
"3-5 minute walk","2 minute stretch"
],
[
"5 minute stretch/warm-up","Workout:",
"6 x 25 pushups","6 x 25 situps","2 x 8 pullups",
"4 minute walk","7 minute jog","4 minute walk","7 minute jog",
"3-5 minute walk","2 minute stretch"
],
[
"5 minute stretch/warm-up","Workout:",
"6 x 30 pushups","6 x 30 situps","2 x 10 pullups",
"4 minute walk","8 minute jog","4 minute walk","8 minute jog",
"3-5 minute walk","2 minute stretch"
],
[
"5 minute stretch/warm-up","Workout:",
"6 x 30 pushups","6 x 30 situps","2 x 10 pullups",
"4 minute walk","9 minute jog","4 minute walk","9 minute jog",
"3-5 minute walk","2 minute stretch"
],
[
"5 minute stretch/warm-up","Workout:",
"6 x 30 pushups","6 x 30 situps","3 x 10 pullups",
"4 minute walk","13 minute run",
"3-5 minute walk","2 minute stretch"
],
[
"5 minute stretch/warm-up","No workout this week",
"4 minute walk","15 minute run",
"3-5 minute walk","2 minute stretch"
],
[
"5 minute stretch/warm-up","Workout:",
"6 x 30 pushups","6 x 35 situps","3 x 10 pullups","3 x 20 dips",
"4 minute walk","17 minute run",
"3-5 minute walk","2 minute stretch"
],
[
"5 minute stretch/warm-up","Workout:",
"6 x 30 pushups","6 x 35 situps","3 x 10 pullups","3 x 20 dips",
"1 minute walk","17 minute run",
"3-5 minute walk","2 minute stretch"
],
[
"5 minute stretch/warm-up","Workout:",
"10 x 20 pushups","10 x 25 situps","4 x 10 pullups","10 x 15 dips",
"2 minute walk","2 minute jog","17 minute run",
"3-5 minute walk","2 minute stretch"
],
[
"5 minute stretch/warm-up","Workout:",
"10 x 20 pushups","10 x 25 situps","4 x 10 pullups","10 x 15 dips",
"3 minute jog","17 minute run",
"3-5 minute walk","2 minute stretch"
],
[
"5 minute stretch/warm-up","Workout:",
"15 x 20 pushups","15 x 25 situps","4 x 12 pullups","15 x 15 dips",
"3 minute jog","17 minute run",
"3-5 minute walk","2 minute stretch"
],
[
"5 minute stretch/warm-up","Workout:",
"20 x 20 pushups","25 x 25 situps","5 x 12 pullups","20 x 15 dips",
"3 minute jog","17 minute run",
"3-5 minute walk","2 minute stretch"
]
];

/* =========================
   STATE + SAVE STRING
   ========================= */
let weeksCount = WEEKS.length;
let bitsPerWeek = WEEKS[0].length * 7;
let saveBits = "0".repeat(bitsPerWeek * weeksCount);

function encodeSave(){
  let out="";
  for(let w=1;w<=weeksCount;w++){
    out+="w"+w+saveBits.slice((w-1)*bitsPerWeek,w*bitsPerWeek);
  }
  return out;
}

function decodeSave(txt){
  let bits="";
  const matches=[...txt.matchAll(/w\d+/g)];
  matches.forEach((m,i)=>{
    const start=m.index+m[0].length;
    const end=i+1<matches.length?matches[i+1].index:txt.length;
    bits+=txt.slice(start,end);
  });
  saveBits=bits;
  weeksCount=bits.length/bitsPerWeek;
}

function bitIndex(w,i,d){
  return (w*bitsPerWeek)+(i*7)+d;
}

/* =========================
   RENDER
   ========================= */
function render(){
  const root=document.getElementById("weeks");
  root.innerHTML="";
  for(let w=0;w<weeksCount;w++){
    const det=document.createElement("details");
    det.className="week";
    const sum=document.createElement("summary");
    sum.textContent="Week "+(w+1);
    det.appendChild(sum);
    const body=document.createElement("div");
    body.className="week-body";
    (WEEKS[w]||WEEKS[15]).forEach((t,i)=>{
      const r=document.createElement("div");
      r.className="row";
      r.innerHTML=`<small>${t}</small>`;
      for(let d=0;d<7;d++){
        const idx=bitIndex(w,i,d);
        const cb=document.createElement("input");
        cb.type="checkbox";
        cb.checked=saveBits[idx]==="1";
        cb.onchange=()=>{
          saveBits=saveBits.substring(0,idx)+(cb.checked?"1":"0")+saveBits.substring(idx+1);
          schedulePush();
        };
        r.appendChild(cb);
      }
      body.appendChild(r);
    });
    det.appendChild(body);
    root.appendChild(det);
  }
}
render();

/* =========================
   ADD WEEK
   ========================= */
function addWeek(){
  weeksCount++;
  saveBits+= "0".repeat(bitsPerWeek);
  render();
  schedulePush();
}

/* =========================
   IMPORT / EXPORT
   ========================= */
function copySave(){navigator.clipboard.writeText(encodeSave())}
function downloadSave(){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([encodeSave()],{type:"text/plain"}));
  a.download="savefile.txt";
  a.click();
}
function pasteImport(){
  const t=prompt("Paste save text:");
  if(t) decodeSave(t),render(),schedulePush();
}
function importFile(inp){
  const r=new FileReader();
  r.onload=e=>decodeSave(e.target.result),render(),schedulePush();
  r.readAsText(inp.files[0]);
}

/* =========================
   GITHUB SYNC
   ========================= */
async function gh(method,url,body){
  return fetch(url,{
    method,
    headers:{
      Authorization:"Bearer "+GH_TOKEN,
      Accept:"application/vnd.github+json"
    },
    body:body?JSON.stringify(body):null
  }).then(r=>r.json());
}

async function pull(){
  const u=`https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${GH_PATH}?ref=${GH_BRANCH}`;
  const d=await gh("GET",u);
  decodeSave(atob(d.content));
  render();
}

let pushTimer=null;
function schedulePush(){
  document.getElementById("status").textContent="Saving…";
  clearTimeout(pushTimer);
  pushTimer=setTimeout(push,800);
}

async function push(){
  const u=`https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/${GH_PATH}`;
  const cur=await gh("GET",u);
  await gh("PUT",u,{
    message:"Update workout save",
    content:btoa(encodeSave()),
    sha:cur.sha,
    branch:GH_BRANCH
  });
  document.getElementById("status").textContent="Saved to GitHub";
}

pull();
</script>
</body>
</html>
